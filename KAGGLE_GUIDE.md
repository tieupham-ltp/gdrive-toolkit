# üéØ H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng gdrive-toolkit tr√™n Kaggle

## üìã M·ª•c L·ª•c
- [C√†i ƒê·∫∑t Nhanh](#c√†i-ƒë·∫∑t-nhanh)
- [Thi·∫øt L·∫≠p Credentials](#thi·∫øt-l·∫≠p-credentials)
- [S·ª≠ D·ª•ng C∆° B·∫£n](#s·ª≠-d·ª•ng-c∆°-b·∫£n)
- [V√≠ D·ª• Th·ª±c T·∫ø](#v√≠-d·ª•-th·ª±c-t·∫ø)

---

## üöÄ C√†i ƒê·∫∑t Nhanh

### B∆∞·ªõc 1: C√†i ƒë·∫∑t th∆∞ vi·ªán

Trong Kaggle Notebook, ch·∫°y cell ƒë·∫ßu ti√™n:

```python
# C√†i ƒë·∫∑t gdrive-toolkit t·ª´ GitHub
!pip install git+https://github.com/tieupham-ltp/gdrive-toolkit.git

# Ho·∫∑c n·∫øu ƒë√£ publish l√™n PyPI:
# !pip install gdrive-toolkit
```

### B∆∞·ªõc 2: Import v√† k·∫øt n·ªëi

```python
from gdrive_toolkit import quick_connect

# K·∫øt n·ªëi t·ª± ƒë·ªông (t·ª± ph√°t hi·ªán m√¥i tr∆∞·ªùng Kaggle)
drive = quick_connect()

# ‚ö†Ô∏è N·∫æU AUTO-DETECT B·ªä SAI (nh·∫≠n di·ªán l√† Colab thay v√¨ Kaggle):
# D√πng option force_env ƒë·ªÉ ch·ªâ ƒë·ªãnh r√µ m√¥i tr∆∞·ªùng
drive = quick_connect(force_env='kaggle')
```

---

## üîë Thi·∫øt L·∫≠p Credentials

‚ö†Ô∏è **L∆∞u √Ω quan tr·ªçng:** Kaggle notebooks kh√¥ng h·ªó tr·ª£ authentication interactive (nh·∫≠p code tr·ª±c ti·∫øp). B·∫°n c·∫ßn setup credentials tr∆∞·ªõc b·∫±ng 1 trong 2 c√°ch sau:

### C√°ch 1: D√πng Refresh Token (Khuy·∫øn ngh·ªã ‚≠ê)

#### B∆∞·ªõc 1: T·∫°o OAuth 2.0 Credentials tr√™n Google Cloud

1. Truy c·∫≠p [Google Cloud Console](https://console.cloud.google.com/)
2. T·∫°o project m·ªõi ho·∫∑c ch·ªçn project c√≥ s·∫µn
3. Enable **Google Drive API**:
   - V√†o "APIs & Services" > "Library"
   - T√¨m "Google Drive API" v√† click "Enable"

4. T·∫°o OAuth 2.0 Credentials:
   - V√†o "APIs & Services" > "Credentials"
   - Click "Create Credentials" > "OAuth client ID"
   - Application type: **"Desktop app"** (quan tr·ªçng!)
   - ƒê·∫∑t t√™n: "Kaggle Drive Access"
   - Click "Create"

5. Download file JSON credentials (`client_secrets.json`)

#### B∆∞·ªõc 2: T·∫°o Refresh Token (Tr√™n M√°y Local)

**Ch·∫°y script tr√™n m√°y local ƒë·ªÉ l·∫•y refresh token:**

```bash
# Clone repo
git clone https://github.com/tieupham-ltp/gdrive-toolkit.git
cd gdrive-toolkit

# C√†i pydrive2
pip install pydrive2

# Ch·∫°y script (client_secrets.json ph·∫£i ·ªü c√πng folder)
python get_refresh_token.py
```

Script s·∫Ω:
1. M·ªü browser ƒë·ªÉ b·∫°n ƒëƒÉng nh·∫≠p Google
2. Sau khi authorize, hi·ªÉn th·ªã 3 gi√° tr·ªã:
   - `GDRIVE_CLIENT_ID`
   - `GDRIVE_CLIENT_SECRET`
   - `GDRIVE_REFRESH_TOKEN` ‚≠ê
3. L∆∞u v√†o file `kaggle_secrets.txt`

üí° **M·∫πo:** N·∫øu kh√¥ng c√≥ m√°y local, c√≥ th·ªÉ ch·∫°y script n√†y tr√™n Google Colab!

#### B∆∞·ªõc 3: Th√™m v√†o Kaggle Secrets

1. Truy c·∫≠p [Kaggle Settings > Secrets](https://www.kaggle.com/settings)
2. Click "Add a new secret"
3. Th√™m **3 secrets** (copy t·ª´ output script):

```
Name: GDRIVE_CLIENT_ID
Value: [Paste client_id t·ª´ script output]

Name: GDRIVE_CLIENT_SECRET
Value: [Paste client_secret t·ª´ script output]

Name: GDRIVE_REFRESH_TOKEN
Value: [Paste refresh_token t·ª´ script output]
```

#### B∆∞·ªõc 4: Enable Secrets trong Notebook

1. M·ªü Kaggle Notebook
2. Click **Settings** (‚öôÔ∏è g√≥c ph·∫£i)
3. Trong **Secrets**, toggle ON c·∫£ 3:
   - ‚úÖ GDRIVE_CLIENT_ID
   - ‚úÖ GDRIVE_CLIENT_SECRET
   - ‚úÖ GDRIVE_REFRESH_TOKEN

#### B∆∞·ªõc 5: S·ª≠ D·ª•ng

```python
from gdrive_toolkit import quick_connect

# K·∫øt n·ªëi (t·ª± ƒë·ªông d√πng refresh token t·ª´ Kaggle Secrets)
drive = quick_connect(force_env='kaggle')

# Upload file
from gdrive_toolkit import upload_file
upload_file(drive, '/kaggle/working/result.csv')
```

‚úÖ **Xong!** Kh√¥ng c·∫ßn authenticate l·∫°i, t·ª± ƒë·ªông ho·∫°t ƒë·ªông m·ªói l·∫ßn ch·∫°y!

---

### C√°ch 2: Upload Credentials File

N·∫øu b·∫°n ƒë√£ c√≥ file credentials t·ª´ m√°y local:

**B∆∞·ªõc 1: T·∫°o credentials tr√™n local**
```python
# Ch·∫°y tr√™n m√°y local
from gdrive_toolkit import quick_connect
drive = quick_connect()  # S·∫Ω t·∫°o file mycreds.txt
```

**B∆∞·ªõc 2: Upload l√™n Kaggle**
1. T·∫°o dataset Kaggle ch·ª©a file `mycreds.txt`
2. Add dataset v√†o notebook

**B∆∞·ªõc 3: Copy file trong notebook**
```python
# Copy credentials file
!cp /kaggle/input/your-dataset/mycreds.txt /kaggle/working/gdrive_credentials.json

# Sau ƒë√≥ connect (ch·ªâ c·∫ßn CLIENT_ID v√† CLIENT_SECRET secrets)
from gdrive_toolkit import quick_connect
drive = quick_connect(force_env='kaggle')
```

---

### So S√°nh 2 C√°ch:

| | C√°ch 1: Refresh Token | C√°ch 2: Upload File |
|---|---|---|
| **Setup** | 1 l·∫ßn tr√™n local | M·ªói l·∫ßn notebook m·ªõi |
| **Secrets c·∫ßn** | 3 (CLIENT_ID, CLIENT_SECRET, REFRESH_TOKEN) | 2 + file upload |
| **Ti·ªán l·ª£i** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Auto | ‚≠ê‚≠ê‚≠ê Ph·∫£i copy file |
| **B·∫£o m·∫≠t** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Token trong Secrets | ‚≠ê‚≠ê‚≠ê File public n·∫øu dataset public |

**‚Üí Khuy·∫øn ngh·ªã: D√πng C√°ch 1 (Refresh Token)**

```python
from gdrive_toolkit.auth import authenticate_kaggle
from pydrive2.drive import GoogleDrive

# Upload file client_secrets.json v√†o /kaggle/working/
# Sau ƒë√≥:
drive = authenticate_kaggle(
    client_id='your_client_id',
    client_secret='your_client_secret'
)
```

---

## üí° S·ª≠ D·ª•ng C∆° B·∫£n

### 1Ô∏è‚É£ Upload File

```python
from gdrive_toolkit import quick_connect, upload_file

drive = quick_connect(force_env='kaggle')

# Upload 1 file - L∆∞u √Ω: d√πng 'file_path' kh√¥ng ph·∫£i 'local_path'
file_id = upload_file(
    drive, 
    file_path='/kaggle/input/dataset/data.csv',  # ‚úÖ ƒê√∫ng
    file_name='my_data.csv',
    folder_id=None  # None = upload v√†o root
)

print(f"File uploaded with ID: {file_id}")
```

print(f"File uploaded with ID: {file_id}")
```

### 2Ô∏è‚É£ Download File

```python
from gdrive_toolkit import download_file, search_files

# T√¨m file theo t√™n
files = search_files(drive, query="name contains 'data.csv'")
if files:
    file_id = files[0]['id']
    
    # Download v·ªÅ Kaggle
    download_file(
        drive,
        file_id=file_id,
        save_path='/kaggle/working/downloaded_data.csv'
    )
```

### 3Ô∏è‚É£ T·∫°o v√† Upload v√†o Folder

```python
from gdrive_toolkit import create_folder_path, upload_file

# T·∫°o c·∫•u tr√∫c folder (gi·ªëng mkdir -p)
folder_id = create_folder_path(drive, "Kaggle/Datasets/2025")

# Upload v√†o folder ƒë√≥
upload_file(
    drive,
    file_path='/kaggle/working/result.csv',  # ‚úÖ ƒê√∫ng: file_path
    folder_id=folder_id
)
```

### 4Ô∏è‚É£ Zip v√† Upload Folder

```python
from gdrive_toolkit import zip_and_upload

# Zip to√†n b·ªô folder v√† upload l√™n Google Drive
file_id = zip_and_upload(
    drive,
    folder_path='/kaggle/working/output',
    zip_name='kaggle_results.zip',
    parent_id=None  # None = upload v√†o root
)

print(f"Zipped and uploaded! File ID: {file_id}")
```

---

## üéØ V√≠ D·ª• Th·ª±c T·∫ø

### V√≠ d·ª• 1: Save Model v√†o Google Drive

```python
from gdrive_toolkit import quick_connect, create_folder_path, upload_file
import joblib

# 1. Train model
from sklearn.ensemble import RandomForestClassifier
model = RandomForestClassifier()
# ... train model ...

# 2. Save model locally
joblib.dump(model, '/kaggle/working/model.pkl')

# 3. Upload l√™n Google Drive
drive = quick_connect(force_env='kaggle')

# T·∫°o folder cho project
folder_id = create_folder_path(drive, "Kaggle/Models/RandomForest")

# Upload model
model_id = upload_file(
    drive,
    file_path='/kaggle/working/model.pkl',  # ‚úÖ ƒê√∫ng: file_path
    file_name=f'model_{pd.Timestamp.now().strftime("%Y%m%d_%H%M%S")}.pkl',
    folder_id=folder_id
)

print(f"‚úì Model saved to Google Drive: {model_id}")
```

### V√≠ d·ª• 2: Download Dataset t·ª´ Google Drive

```python
from gdrive_toolkit import quick_connect, search_files, download_file
import pandas as pd

# K·∫øt n·ªëi
drive = quick_connect(force_env='kaggle')

# T√¨m dataset tr√™n Drive
files = search_files(drive, query="name = 'train_data.csv'")

if files:
    # Download v·ªÅ Kaggle
    download_file(
        drive,
        file_id=files[0]['id'],
        save_path='/kaggle/working/train_data.csv'
    )
    
    # Load v√†o pandas
    df = pd.read_csv('/kaggle/working/train_data.csv')
    print(f"Loaded {len(df)} rows")
else:
    print("Dataset not found on Google Drive")
```

### V√≠ d·ª• 3: Backup K·∫øt Qu·∫£ Competition

```python
from gdrive_toolkit import quick_connect, create_folder_path, upload_file
from datetime import datetime

drive = quick_connect(force_env='kaggle')

# T·∫°o folder theo competition
competition_name = "titanic"
folder_path = f"Kaggle/Competitions/{competition_name}"
folder_id = create_folder_path(drive, folder_path)

# Upload submission file
submission_id = upload_file(
    drive,
    file_path='/kaggle/working/submission.csv',  # ‚úÖ ƒê√∫ng: file_path
    file_name=f'submission_{datetime.now():%Y%m%d_%H%M%S}.csv',
    folder_id=folder_id
)

# Upload notebook (n·∫øu c√≥ export)
notebook_id = upload_file(
    drive,
    file_path='/kaggle/working/notebook.ipynb',  # ‚úÖ ƒê√∫ng: file_path
    file_name=f'notebook_{datetime.now():%Y%m%d_%H%M%S}.ipynb',
    folder_id=folder_id
)

print("‚úì Backup completed!")
print(f"  - Submission: {submission_id}")
print(f"  - Notebook: {notebook_id}")
```

### V√≠ d·ª• 4: Upload Nhi·ªÅu Files C√πng L√∫c

```python
from gdrive_toolkit import batch_upload, quick_connect
import glob

drive = quick_connect(force_env='kaggle')

# T√¨m t·∫•t c·∫£ file CSV trong working directory
csv_files = glob.glob('/kaggle/working/*.csv')

# Upload h·∫øt l√™n Google Drive
file_ids = batch_upload(
    drive,
    file_paths=csv_files,
    folder_id=None,  # ho·∫∑c ch·ªâ ƒë·ªãnh folder_id
    verbose=True
)

print(f"‚úì Uploaded {len(file_ids)} files")
```

### V√≠ d·ª• 5: Zip v√† Upload Output Folder

```python
from gdrive_toolkit import quick_connect, create_folder_path, zip_and_upload
import pandas as pd

drive = quick_connect(force_env='kaggle')

drive = quick_connect()
client = GDriveClient(drive)

# T·∫°o folder tr√™n Drive
drive_folder_id = create_folder_path(drive, "Kaggle/Output")

# Zip to√†n b·ªô output folder v√† upload
zip_id = client.zip_and_upload(
    folder_path='/kaggle/working',
    zip_name=f'kaggle_output_{pd.Timestamp.now():%Y%m%d}.zip',
    parent_id=drive_folder_id
)

print(f"‚úì All output synced to Google Drive: {zip_id}")
```

---

## üîß Template Notebook Ho√†n Ch·ªânh

```python
# Cell 1: C√†i ƒë·∫∑t
!pip install git+https://github.com/tieupham-ltp/gdrive-toolkit.git

# Cell 2: Import
import pandas as pd
from gdrive_toolkit import quick_connect, create_folder_path, upload_file, zip_and_upload

# Cell 3: K·∫øt n·ªëi Google Drive
drive = quick_connect(force_env='kaggle')

# Cell 4: Setup folders
project_folder = create_folder_path(drive, "Kaggle/MyProject")
print(f"Project folder ID: {project_folder}")

# Cell 5: Your analysis/training code here
# ... your code ...

# Cell 6: Save results to Google Drive
# Upload predictions
upload_file(
    drive,
    file_path='/kaggle/working/predictions.csv',  # ‚úÖ ƒê√∫ng: file_path
    file_name='predictions.csv',
    folder_id=project_folder
)

# Backup all outputs
zip_and_upload(
    drive,
    folder_path='/kaggle/working',
    zip_name='kaggle_outputs.zip',
    parent_id=project_folder
)

# Backup all outputs
client.zip_and_upload(
    folder_path='/kaggle/working',
    zip_name='kaggle_outputs.zip',
    parent_id=project_folder
)

print("‚úì All results saved to Google Drive!")
```

---

## ‚ö†Ô∏è L∆∞u √ù Quan Tr·ªçng

### 1. Kaggle Secrets
- **B·∫Øt bu·ªôc** ph·∫£i enable secrets trong notebook settings
- Secrets ch·ªâ available khi notebook ƒëang ch·∫°y
- Kh√¥ng th·ªÉ access secrets t·ª´ forked notebooks (b·∫£o m·∫≠t)

### 2. Quy·ªÅn Truy C·∫≠p
- L·∫ßn ƒë·∫ßu ch·∫°y s·∫Ω c·∫ßn x√°c th·ª±c qua browser
- Link x√°c th·ª±c s·∫Ω hi·ªán trong output cell
- Copy link, m·ªü trong tab m·ªõi, login v√† copy code v·ªÅ

### 3. Gi·ªõi H·∫°n
- Kaggle c√≥ timeout cho notebook (9 hours max)
- Upload file l·ªõn n√™n d√πng `upload_large_file()` v·ªõi chunk_size
- Google Drive API c√≥ quota limit (check t·∫°i Cloud Console)

### 4. Best Practices
- ‚úÖ D√πng Kaggle Secrets cho credentials
- ‚úÖ T·∫°o folder structure r√µ r√†ng tr√™n Drive
- ‚úÖ Th√™m timestamp v√†o t√™n file ƒë·ªÉ tr√°nh ghi ƒë√®
- ‚úÖ Backup code v√† results sau m·ªói experiment
- ‚úÖ X√≥a file t·∫°m trong /kaggle/working sau khi upload

---

## üÜò X·ª≠ L√Ω L·ªói Th∆∞·ªùng G·∫∑p

### L·ªói: "Detected environment: COLAB" tr√™n Kaggle ‚ö†Ô∏è

**Tri·ªáu ch·ª©ng:** Khi ch·∫°y `quick_connect()` tr√™n Kaggle nh∆∞ng hi·ªán "Detected environment: COLAB"

**Nguy√™n nh√¢n:** M·ªôt s·ªë Kaggle notebook c√≥ package `google.colab` ƒë∆∞·ª£c c√†i s·∫µn, g√¢y nh·∫ßm l·∫´n trong auto-detection

**Gi·∫£i ph√°p:**
```python
# Option 1: Force environment (Khuy·∫øn ngh·ªã)
from gdrive_toolkit import quick_connect
drive = quick_connect(force_env='kaggle')

# Option 2: G·ªçi tr·ª±c ti·∫øp h√†m authenticate_kaggle
from gdrive_toolkit.auth import authenticate_kaggle
drive = authenticate_kaggle()
```

### L·ªói: "Secrets not found"
```python
# Ki·ªÉm tra secrets c√≥ ƒë∆∞·ª£c enable kh√¥ng
import os
print("GDRIVE_CLIENT_ID:", os.getenv('GDRIVE_CLIENT_ID') is not None)
print("GDRIVE_CLIENT_SECRET:", os.getenv('GDRIVE_CLIENT_SECRET') is not None)
```
‚û°Ô∏è **Gi·∫£i ph√°p**: Enable secrets trong Notebook Settings

### L·ªói: "Authentication failed"
‚û°Ô∏è **Gi·∫£i ph√°p**: 
1. Ki·ªÉm tra client_id v√† client_secret c√≥ ƒë√∫ng kh√¥ng
2. ƒê·∫£m b·∫£o ƒë√£ Enable Google Drive API
3. Th·ª≠ x√≥a file `/kaggle/working/credentials.json` v√† authenticate l·∫°i

### L·ªói: Version c≈© kh√¥ng update
```python
# C√†i l·∫°i v·ªõi force reinstall v√† no cache
!pip uninstall -y gdrive-toolkit
!pip install --no-cache-dir --force-reinstall git+https://github.com/tieupham-ltp/gdrive-toolkit.git

# Sau ƒë√≥ restart kernel: Session > Restart Session
```

### L·ªói: "Quota exceeded"
‚û°Ô∏è **Gi·∫£i ph√°p**: 
1. Check quota t·∫°i [Google Cloud Console](https://console.cloud.google.com/apis/api/drive.googleapis.com/quotas)
2. ƒê·ª£i quota reset (th∆∞·ªùng reset h√†ng ng√†y)
3. Ho·∫∑c request tƒÉng quota

---

## üìö T√†i Li·ªáu Tham Kh·∫£o

- [API Reference](https://github.com/tieupham-ltp/gdrive-toolkit/blob/main/docs/API_REFERENCE.md)
- [CLI Guide](https://github.com/tieupham-ltp/gdrive-toolkit/blob/main/docs/CLI_GUIDE.md)
- [More Examples](https://github.com/tieupham-ltp/gdrive-toolkit/tree/main/examples)

---

## üí¨ H·ªó Tr·ª£

G·∫∑p v·∫•n ƒë·ªÅ? T·∫°o issue t·∫°i: https://github.com/tieupham-ltp/gdrive-toolkit/issues

---

**Happy Kaggling! üéâ**
